# vim: ft=cfg
# ===================================================================
# == Editor / Pager
# ===================================================================
# The first and most important rule: text files and code should open in your editor.
mime ^text,          label editor = ${VISUAL:-$EDITOR} -- "$@"
!mime ^text, ext xml|json|csv|tex|py|pl|rb|js|sh|php, label editor = ${VISUAL:-$EDITOR} -- "$@"
# As a fallback, view text files in your pager.
mime ^text,          label pager  = "$PAGER" -- "$@"
!mime ^text, ext xml|json|csv|tex|py|pl|rb|js|sh|php, label pager  = "$PAGER" -- "$@"

# ===================================================================
# == Documents
# ===================================================================
# Prioritize zathura for its TUI-centric design and vi-keys. mupdf is a minimal fallback.
ext pdf|epub|djvu|cbr|cbz, has zathura, X, flag f = zathura -- "$@"
ext pdf|epub|djvu,         has mupdf,   X, flag f = mupdf -- "$@"

# ===================================================================
# == Images
# ===================================================================
# sxiv is the primary choice for its minimalist, scriptable nature.
# feh is an excellent, powerful alternative, especially for wallpaper setting.
mime ^image, has sxiv, X, flag f = sxiv -a -- "$@"
mime ^image, has feh,  X, flag f = feh -- "$@"
mime ^image, has imv,  X, flag f = imv -- "$@"

# Rule for setting wallpaper from ranger. Use with :open_with wallpaper
label wallpaper, number 11, mime ^image, has feh, X = feh --bg-scale "$1"

# Vector graphics in Inkscape
mime ^image/svg, has inkscape, X, flag f = inkscape -- "$@"

# ===================================================================
# == Video & Audio
# ===================================================================
# mpv is the single, superior choice for all media playback, both in terminal and GUI.
mime ^video|audio, has mpv, X, flag f = mpv -- "$@"
mime ^video|audio, has mpv, X, flag f, label fullscreen = mpv --fs -- "$@"
mime ^video|audio, has mpv, terminal, !X = mpv -- "$@"

# ===================================================================
# == Web & Torrents
# ===================================================================
# A curated list of browsers. Re-order to set your preference.
ext x?html?, has firefox,      X, flag f = firefox -- "$@"
ext x?html?, has qutebrowser,  X, flag f = qutebrowser -- "$@"
ext x?html?, has chromium,     X, flag f = chromium -- "$@"
# Terminal-based browsers
ext x?html?, has w3m,       terminal = w3m "$@"
ext x?html?, has links,     terminal = links "$@"
ext x?html?, has lynx,      terminal = lynx -- "$@"

# Open magnet links with a TUI-based torrent client.
match ^magnet:, has transmission-remote-cli, terminal = transmission-remote-cli --add "$1"

# ===================================================================
# == Archives
# ===================================================================
# Use atool for unified archive management. It intelligently handles most formats.
ext 7z|ace|ar|arc|bz2?|cab|cpio|cpt|deb|dgc|dmg|gz|iso|jar|msi|pkg|rar|shar|tar|tgz|xar|xpi|xz|zip, has atool, label view = atool --list --each -- "$@" | "$PAGER"
ext 7z|ace|ar|arc|bz2?|cab|cpio|cpt|deb|dgc|dmg|gz|iso|jar|msi|pkg|rar|shar|tar|tgz|xar|xpi|xz|zip, has atool, label extract = atool --extract --each -- "$@"

# Fallback for tar if atool is not present
ext tar|gz|bz2|xz, has tar, label view = tar vvtf "$1" | "$PAGER"
ext tar|gz|bz2|xz, has tar, label extract = for file in "$@"; do tar vvxf "$file"; done

# ===================================================================
# == System & Scripts
# ===================================================================
# Execute scripts with their respective interpreters
ext py  = python3 -- "$1"
ext pl  = perl -- "$1"
ext rb  = ruby -- "$1"
ext js  = node -- "$1"
ext sh  = sh -- "$1"
ext php = php -- "$1"

# Handle Makefiles
name ^[mM]akefile$ = make

# Execute binaries
mime application/x-executable = "$1"

# ===================================================================
# == Terminal Emulator
# ===================================================================
# Prioritize terminals based on your specified stack (Alacritty/Kitty).
mime ^ranger/x-terminal-emulator, has alacritty = alacritty -e "$@"
mime ^ranger/x-terminal-emulator, has kitty     = kitty -- "$@"
mime ^ranger/x-terminal-emulator, has st        = st -e "$@"
mime ^ranger/x-terminal-emulator, has urxvt     = urxvt -e "$@"

# ===================================================================
# == Final Fallbacks
# ===================================================================
# Use trash-cli for safe deletion.
label trash, has trash-put = trash-put -- "$@"
# As a last resort, use xdg-open for GUI or ask the user.
label open, has xdg-open = xdg-open -- "$@"
else, X, has xdg-open = xdg-open -- "$@"
else = ask
