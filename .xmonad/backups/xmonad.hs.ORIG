import qualified XMonad.StackSet as W
import XMonad
import System.Exit (exitWith, ExitCode(ExitSuccess))
import System.IO (hPutStrLn)
import XMonad.Hooks.DynamicLog
import XMonad.Hooks.ManageDocks
import XMonad.Hooks.SetWMName
import XMonad.Util.Run (spawnPipe)
import XMonad.Util.SpawnOnce
import XMonad.Util.EZConfig (additionalKeys)
import XMonad.Layout.Spacing
import XMonad.Layout.Gaps
import XMonad.Layout.NoBorders
import XMonad.Layout.Grid

-- üß± Terminal & Modifier
myTerminal :: String
myTerminal = "alacritty"

myModMask :: KeyMask
myModMask = mod4Mask -- Super/Windows key

-- üß† Layouts: gaps + spacing + variants
myLayoutHook = avoidStruts $
  gaps [(U,8), (D,8), (L,8), (R,8)] $
  spacing 8 $
  Grid ||| tiled ||| Mirror tiled ||| noBorders Full
  where
    tiled = Tall 1 (3/100) (1/2)

-- üöÄ Startup: picom + nitrogen + WM name for Java apps
myStartupHook :: X ()
myStartupHook = do
  spawnOnce "picom &"
  spawnOnce "nitrogen --restore &"
  setWMName "LG3D"

-- üéõÔ∏è Main Config
main :: IO ()
main = do
  xmproc <- spawnPipe "xmobar ~/.xmobarrc"
  xmonad $ docks def
    { modMask = myModMask
    , terminal = myTerminal
    , layoutHook = myLayoutHook
    , borderWidth = 4
    , startupHook = myStartupHook
    , focusFollowsMouse = False 
    , clickJustFocuses = False
    , logHook = dynamicLogWithPP xmobarPP
        { ppOutput = hPutStrLn xmproc
        , ppTitle = xmobarColor "#a6e3a1" "" . shorten 60
        , ppCurrent = xmobarColor "#89b4fa" "" . wrap "[" "]"
        , ppVisible = wrap "<" ">"
        , ppLayout = xmobarColor "#f38ba8" ""
        , ppSep = " | "
        }
    }
    `additionalKeys`
    [ ((myModMask, xK_Return), spawn myTerminal)                    -- MOD+Enter
    , ((myModMask .|. shiftMask, xK_c), kill)                       -- MOD+Shift+C
    , ((myModMask .|. mod1Mask, xK_q), io (exitWith ExitSuccess))  -- MOD+Alt+Q
    , ((myModMask, xK_r), spawn "rofi -show run") -- MOD + p = launcher
    , ((myModMask .|. shiftMask, xK_r), spawn "xmonad --recompile && xmonad --restart") -- MOD+Shift+R
    , ((myModMask .|. shiftMask, xK_t), withFocused $ windows . W.sink) -- MOD+Shift+T to re-tile
    ]

